// ================================================================================================================================
// ================================================================================================================================
// ================================================================================================================================

#include "interrupts.h"
#include "keyboard.h"
#include "display.h"
#include "stdint.h"
#include "gdefs.h"
#include "timer.h"
#include "pic.h"

// ================================================================================================================================
// ================================================================================================================================

void kernel_main (void);
void timerTest (void);

// ================================================================================================================================
// ==== Kernel main ===============================================================================================================
// ================================================================================================================================

void kernel_main (void)
{
    // ----------------------------------------------------------------------------------------------------------------------------

    clearScreen ();

    // ----------------------------------------------------------------------------------------------------------------------------

    /*
    QWORD a = 0x1122334455667788;

    print ("This is a test for the features related to %% : %qd  -  %qh\n", a, a);
    printSuccess ("This is a test for the features related to %% : %qd  -  %qh\n", a, a);
    printError ("This is a test for the features related to %% : %qd  -  %qh\n", a, a);
    println ("This is a test for the features related to %% : %qd  -  %qh\n", a, a);
    */

    // ----------------------------------------------------------------------------------------------------------------------------

    println ( \
        "================================================================================" \
        "======================    Hello! I' m the captain now!    ======================" \
        "================================================================================"
    );

    // ----------------------------------------------------------------------------------------------------------------------------

    print (" Initializing PIC             .......................................      ");

    picEnable (40, 48);

    println ("Done");

    // ----------------------------------------------------------------------------------------------------------------------------

    print (" Initializing Interrupts      .......................................      ");

    interruptInitialization ();

    println ("Done");

    // ----------------------------------------------------------------------------------------------------------------------------

    print (" Initializing Timer           .......................................      ");

    timerInitialization ();

    println ("Done");

    // ----------------------------------------------------------------------------------------------------------------------------

    print (" Initializing Keyboard        .......................................      ");

    keyboardInitialization ();

    println ("Done");

    // ----------------------------------------------------------------------------------------------------------------------------

    printNewLine ();

    println ( \
        "================================================================================" \
        "===========================    Everything is set!    ===========================" \
        "================================================================================"
    );

    printNewLine ();

    // ----------------------------------------------------------------------------------------------------------------------------

    asmSTI ();

    // ----------------------------------------------------------------------------------------------------------------------------

    while (true)
    {
        sleep (1000);
    }

    // ----------------------------------------------------------------------------------------------------------------------------

    okEnd ();

    // ----------------------------------------------------------------------------------------------------------------------------
}

// ================================================================================================================================
// ================================================================================================================================
// ================================================================================================================================
