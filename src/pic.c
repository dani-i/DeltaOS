// ================================================================================================================================
// ================================================================================================================================
// ================================================================================================================================

#include "pic.h"

// ================================================================================================================================
// ================================================================================================================================

// ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++

void    picEnable (WORD master_offset, WORD slave_offset)
{
    // ----------------------------------------------------------------------------------------------------------------------------

    BYTE    mask1;
    BYTE    mask2;

    // ----------------------------------------------------------------------------------------------------------------------------
    // ----------------- Save current masks. --------------------------------------------------------------------------------------

    mask1 = inB (PIC1_DATA);
    mask2 = inB (PIC2_DATA);

    // ----------------------------------------------------------------------------------------------------------------------------
    // ----------------- Initialization sequence. ---------------------------------------------------------------------------------

    outB (PIC1_COMMAND, PIC_ICW1_INIT | PIC_ICW1_ICW4);
    outB (PIC2_COMMAND, PIC_ICW1_INIT | PIC_ICW1_ICW4);

    outB (PIC1_DATA, (BYTE)master_offset);
    outB (PIC2_DATA, (BYTE)slave_offset);

    outB (PIC1_DATA, 0x4);
    outB (PIC2_DATA, 0x2);

    outB (PIC1_DATA, PIC_ICW4_8086);
    outB (PIC2_DATA, PIC_ICW4_8086);

    // ----------------------------------------------------------------------------------------------------------------------------
    // ----------------- Restore saved masks. -------------------------------------------------------------------------------------

    outB (PIC1_DATA, mask1);
    outB (PIC2_DATA, mask2);

    // ----------------------------------------------------------------------------------------------------------------------------
}

// ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++

void    picDisable (void)
{
    outB (PIC1_DATA, 0xFF);
    outB (PIC2_DATA, 0xFF);
}

// ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++

void    picSendEOI (BYTE irq)
{
    if (irq < 8)
    {
        outB (PIC1_COMMAND, PIC_EOI);
    }
    else
    {
        outB (PIC2_COMMAND, PIC_EOI);
    }
}

// ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
// ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++

void    irqSet (BYTE irq)
{
    WORD    port;
    BYTE    data;

    if (irq < 8)
    {
        port = PIC1_DATA;
    }
    else
    {
        irq = (BYTE)(irq - 8);
        port = PIC2_DATA;
    }

    data = (BYTE)(inB (port) | (1 << irq));

    outB (port, data);
}

// ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++

void    irqClear (BYTE irq)
{
    WORD    port;
    BYTE    data;

    if (irq < 8)
    {
        port = PIC1_DATA;
    }
    else
    {
        irq = (BYTE)(irq - (BYTE)8);
        port = PIC2_DATA;
    }

    data = (BYTE)(inB (port) & ~(1 << irq));

    outB (port, data);
}

// ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++

// ================================================================================================================================
// ================================================================================================================================
// ================================================================================================================================
